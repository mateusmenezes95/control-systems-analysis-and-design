\section{Desafio II - Teorema do Pequeno Ganho e Anti-Windup} 
 
\subsection{Motivação}
Este dasafio foi dividido em duas partes. A primeira visa a análise de
incertezas na modelagem de sistemas via Teorema do Pequeno Ganho e Teoria de
Controle Robusto. Já a segunda, em série com o resultado da primeira parte,
analisa o comportamento da saída de um modelo de planta, considerando um ponto
de operação específico, e sinal de controle para um sistema em malha fechada na
presença de saturação do sinal de controle.

A análise de incertezas é de suma importância na avaliação de modelagem de plantas
via alguma técnica específica, como resposta ao degrau ou resposta em
frequência. Esta modelagem é realizada principalmente quando não se tem o modelo
teórico. Desta forma é preciso realizar a modelagem com a planta real, obtendo
assim um modelo nominal da planta. Assim, torna-se necessário analisar qual o
efeito das incertezas de modelagem, para garantir a estabilidade do sistema em
malha fechada sendo controlado por um controlador projetado utilizando o modelo
nominal da planta. Esta análise de robustez é obtida via Teorema do Pequeno
Ganho e Teoria da Instabilidade Interna (não contemplada neste desafio).

Além da análise de robustez, é ainda necessário analisar o sistema em malha
fechada obtido através do modelo nominal em um ponto específico de operação na
presença de saturação do sinal de controle. Esta análise também é de extrema
relevância na teoria  e aplicação de controle, pois os sistemas de controle
reais tem limitações, como a energia finita de atuadores, que caso não analisado
corretamente, podem surgir no sistema de controle implementado comportamentos
indesejáveis. Um exemplo comum de saturação é nas malhas de controle de vazão,
em que válvulas na linha do processo tem um limiar de abertura além da presença
de zonas mortas de operação.

\subsection{Simulações realizadas}
O sistema de controle em malha fechada utilizado nas simulações do segundo
desafio é o mesmo do desafio 1 e está descrito no tópico
\ref{sec:desafio-1-simulacoes-realizadas} e ilustrado em diagrama de blocos na
Figura \ref{fig:diagrama-de-blocos-malha-fechada}. O modelo $G(s)$ utilizado nas
simulações é dado por

\begin{equation}
    \label{eq:modelo-g-de-s-utilizado-no-desafio-2}
    G(s) = \frac{K_{i}e^{-sL_{i}}}{T_{i}s + 1}.
\end{equation}

O modelo descrito na Equação \ref{eq:modelo-g-de-s-utilizado-no-desafio-2} foi
levantado a partir de 4 pontos de operação distintos, gerando 4 modelos: M1, M2,
M3 e M4. Os parâmetros obtidos para cada modelo $i$ foram os seguintes: $L_{i} =
[0,9; 0,7; 0,6; 0,4]$, $K_{i} = [1,3; 0,9; 1,2; 0,8]$ e $\tau_{i} = [1,2; 1,1;
0,8; 0,9]$.

Para o projeto do controlador utilizou o modelo nominal de $G(s)$ obtido
através das médias $L_{n}$, $K_{n}$ e $\tau_{n}$ dos parâmetros $L_{i}$, $K_{i}$
e $\tau_{i}$, respectivamente. Assim, obteve-se $G{n}(s)$ dado por

\begin{equation}
    \label{eq:modelo-gn-de-s-utilizado-no-desafio-2}
    G_{n}(s) = \frac{1,05e^{-0,65s}}{s + 1}.
\end{equation}

O controlador utilizado nas simulações foi o PI de Skogestad para um sistema de
primeira ordem com atraso, dado por

\begin{equation}
    \label{eq:modelo-c-de-s-utilizado-no-desafio-2}
    C(s) = K_{c}\frac{sT_{i} + 1}{sT_{i}} = \frac{0,8282(s + 1)}{s}
\end{equation}
em que $K_{c} = \tau_{n}/[K_{n}(\tau_{c} + L_{n})]$, $T_{i} = min(\tau_{n},
4(\tau_{c} + L_{n}))$ e $\tau_{c} = 0,5$. 

A partir destes modelos foram realizadas 3 simulações:
\begin{enumerate}
    \item Geração das incertezas multiplicativas dos 4 modelos e análise de
    robustez via Teorema do Pequeno Ganho;
    \item Resposta em malha fechada dos 4 modelos, dado o controlador definido
    na Equação \ref{eq:modelo-c-de-s-utilizado-no-desafio-2}, com uma entrada de
    referência $r(t)$ em degrau unitário e uma perturbação na entrada $q_{u}(t)$
    também em degrau;
    \item Resposta do modelo M1 em malha fechada com diferentes configurações:
    com filtro de referência $F(s)$, com controlador I+P, com controlador I+P e
    saturação do sinal de controle e com os dois itens anteriores mais a ação de
    anti-windup.
\end{enumerate}

O tópico seguinte irar descrever os resultados obtidos para os 3 itens acima.

\subsection{Resultados obtidos}
\subsubsection{Geração de incertezas multiplicativas}
\label{subsub:geracao-de-incertezas-multiplicativas}
Para cada modelo $G_{i}(s)$ com $i \in [1,4]$, calculou-se o módulo da incerteza
multiplicativa conforme Equação \ref{eq:desafio-2-calculo-das-incertezas}. O
resultado obtido está ilustrado na Figura
\ref{fig:desafio-2-resultado-questao-1}.

\begin{equation}
    \label{eq:desafio-2-calculo-das-incertezas}
    \Delta_{i}(w) = \left | \frac{G_{n}(jw) - G_{i}(jw)}{G_{n}(jw)} \right |,
    10^{-2} \leq w \leq 10^{4}.
\end{equation}

\begin{figure}[!ht]
    \caption{Módulo das incertezas multiplicativas de cada modelo $i$ em
    função da frequência $w$.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:desafio-2-resultado-questao-1}
    \begin{minipage}{\linewidth}
        \input{images/challenge2/resultado-questao-1.tex}
    \end{minipage}
\end{figure}

Para verificar se o sistema em malha fechada com o modelo nominal $G_{n}(s)$ é
estável, calculou-se o módulo da complementar de sensibidade, Equação
\ref{eq:desafio-2:modulo-da-complementar-de-sensibilidade}, que foi multiplicado
pelo limitante superior das incertezas multiplicativas definido pela Equação
\ref{eq:desafio-2:limitante-superior-das-incertezas-multiplicativas}.

\begin{equation}
    \label{eq:desafio-2:modulo-da-complementar-de-sensibilidade}
    |\textit{C}(jw)| = \left | \frac{C(jw)G_{n}(jw)}{1 + C(jw)G_{n}(jw)} \right |
\end{equation}

\begin{equation}
    \label{eq:desafio-2:limitante-superior-das-incertezas-multiplicativas}
    \bar{\Delta}(w[k]) = min(\Delta_{1}(w[k]), \Delta_{2}(w[k]), \Delta_{3}(w[k]),
    \Delta_{4}(w[k])). 
\end{equation}
em que $w[k]$ é um vetor de 10000 pontos em escala logarítimica com $10^{-2}
\leq w \leq 10^{4}$ rad/s.

O resultado obtido está ilustrado na Figura
\ref{fig:desafio-2:resultado-questao-3-4}, em que é possível visualizar o
limitante superior das incertezas multiplicativas $\bar{\Delta}(w)$, o módulo da
função complementar de sensibidade $|\textit{C}(jw)|$ e o resultado da
multiplicação dos dois valores.

\begin{figure}[!ht]
    \caption{Resultado da análise das incertezas multiplicativas.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:desafio-2:resultado-questao-3-4}
    \begin{minipage}{\linewidth}
        \input{images/challenge2/resultado-questao-3-4.tex}
    \end{minipage}
\end{figure}

Conclui-se a a partir do último gráfico da Figura
\ref{fig:desafio-2:resultado-questao-3-4} que o sistema em malha fechada é
estável, dentro de uma faixa de frequência, com a planta em diferentes pontos de
operação dado as incertezas dos modelos M1, M2, M3 e M4 e o controlador $C(s)$
projetado considerando o modelo nominal da planta $G_{n}(s)$. Esta conclusão
pode ser obtida pois

\begin{equation}
    \label{eq:desafio-2:principio-do-modelo-interno}
    \sup_{w}|\textit{C}(jw)|\bar{\Delta}(w) \le 1, \ 10^{-2} \leq \forall w \leq {10^{4}}.
\end{equation}

\subsubsection{Resposta em malha fechadas dos modelos M1, M2, M3 e M4}
\label{subsub:desafio2:resposta-em-malha-fechadas-dos-modelos-m1-m2-m3-e-m4}
Para reforçar a conclusão de robustez obtida conforme discutida no tópico
\ref{subsub:geracao-de-incertezas-multiplicativas}, simulou-se a resposta ao
degrau dos 4 modelos M1, M2, M3 e M4, cuja as funções de transferência são as
Equações \ref{eq:desafio2:modelo-g1}, \ref{eq:desafio2:modelo-g2},
\ref{eq:desafio2:modelo-g3} e \ref{eq:desafio2:modelo-g4}, respectivamente.

\begin{equation}
    \label{eq:desafio2:modelo-g1}
    G_{1}(s) = \frac{1,3e^{-0,9s}}{1,2s + 1},
\end{equation}

\begin{equation}
    \label{eq:desafio2:modelo-g2}
    G_{2}(s) = \frac{0,9e^{-0,7s}}{1,1s + 1},
\end{equation}

\begin{equation}
    \label{eq:desafio2:modelo-g3}
    G_{3}(s) = \frac{1,2e^{-0,6s}}{0,8s + 1},
\end{equation}

\begin{equation}
    \label{eq:desafio2:modelo-g4}
    G_{4}(s) = \frac{0,8e^{-0,4s}}{0,9s + 1}.
\end{equation}

Como esperado, a Figura \ref{fig:desafio2:questao5} demonstra que todos os
sistemas são estáveis quando a malha é fechada utilizando o controlador
projetado com o modelo nominal $G_{n}(s)$ do processo.

\begin{figure}[!ht]
    \caption{Resposta ao degrau para os modelos M1, M2, M3 e M4.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:desafio2:questao5}
    \begin{minipage}{\linewidth}
        \input{images/challenge2/resultado-questao-5.tex}
    \end{minipage}
\end{figure}

É possível observar também na Figura \ref{fig:desafio2:questao5} uma diferença
das respostas ao degrau dos modelos M1 e M4. O primeiro responde com um alto
overshoot e oscilação na resposta transitória. Já o segundo se comporta próximo
a um sistema superamortecido. Com base na resposta em frequência, pode se
analisar tal diferença entre os modelos. Na resposta em frequência, o atraso
$e^{-sL_{i}}$ insere no sistema uma diminuição de fase de formar linear, pois
$\arg\angle e^{-jwL_{i}} = L_{i}w$. Dessa forma, como $L_{1} > L_{4}$, a fase em
altas frequência do sistema do modelo M1 é maior, consequentemente menor margem
de fase e mais próximo do eixo $jw$ os polos do sistema em malha fechada estão.
Como o degrau é rico em altas frequências, o modelo com menor margem de fase
tende a ter maior oscilação e, consequentemente, um maior overshoot. O que é
observado no modelo M1.

\subsubsection{Resposta em malha fechada do modelo M1 com diferentes configurações}
Conforme discutido no final do tópico
\ref{subsub:desafio2:resposta-em-malha-fechadas-dos-modelos-m1-m2-m3-e-m4}, o
modelo M1 apresenta uma resposta transitória ao degrau com alto overshoot e
oscilação. Desta forma, este modelo foi simulado em diferentes configurações do
sistema de controle em malha fechada. Simulou-se a resposta ao degrau e
perturbação na entrada com filtro de referência $F(s)$ de primeira ordem;
utilizando um controlador I+P, com controlador I+P e saturação do sinal de
controle e, por fim, com os dois itens anteriores mais a ação de anti-windup. O
resultado obtido pode ser visto na Figura \ref{fig:desafio2:resultado-questao6}

\begin{figure}[!ht]
    \caption{Simulação do sistema de controle em malhada fechada para diferentes
    configurações.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:desafio2:resultado-questao6}
    \begin{minipage}{\linewidth}
        \input{images/challenge2/resultado-questao-6-9.tex}
    \end{minipage}
\end{figure}

\subsection{Conclusões}
(Concluir em que medida os resultados apresentam relação com a motivação.
Permitem ilustratar ou concluir algo sobre a motivação? )

\begin{figure}[!ht]
    \caption{Simulação do sistema de controle em malhada fechada para condições
    impostas no Cenário 1.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:resultado-extra-desafio2-questao6}
    \begin{minipage}{\linewidth}
        \input{images/challenge2/resultado-extra-questao-6-9.tex}
    \end{minipage}
\end{figure}