\section{Desafio I - Princípio do Modelo Interno}

\subsection{Motivação}
O presente desafio visa analisar como a resposta em regime estacionário de um
sistema de controle em malha fechada se comporta a partir de peturbações
persistentes aplicadas na entrada e na saída da planta em questão. A análise foi
realizada utilizando o Princípio do Modelo Interno que é uma proposição
conceitual, a qual permite concluir sobre as condições para seguimento de
referência em sistema de controle realimentados sujeito a perturbações
persistentes (referenciar documento do professor).

A análise de seguimento de referência via Princípio do Modelo Interno permite
concluir sobre o comportamento da planta controlada para uma dada entrada
inspecionando somente as funções de transferência em malha aberta do sistema.
Dessa forma, pode se inferir mais facilmente o comportamento de uma planta sem
preciso memorizar regras como "modelos de tipo x ou y" e até mesmo sem precisar
realizar cálculos algébricos extensivos.

\subsection{Simulações realizadas}
\label{sec:simulacao-realizadas}
As simulações realizadas utiliziram como base o sistema em malha fechada
representado na Figura \ref{fig:diagrama-de-blocos-malha-fechada} em que:
\begin{itemize}
    \item $R(s)$ é a tranformada de Laplace do sinal de referência $r(t)$;
    \item $E(s)$ é a tranformada de Laplace do erro $e(t)$;
    \item $C(s)$ é a função de transferência do controlador;
    \item $U(s)$ é a tranformada de Laplace do sinal de controle $u(t)$;
    \item $Q_{u}(s)$ é a tranformada de Laplace da perturbação de entrada;
    \item $G(s)$ é a função de transferência da planta;
    \item $Q_{y}(s)$ é a tranformada de Laplace da perturbação na saída; e,
    por fim
    \item $Y(s)$ é a transformada de Laplace da saída do sistema $y(t)$.
\end{itemize}

\begin{figure}[htp]
	\centering
    \captionsetup{justification=centering}
	\caption{Sistema em malha fechada com realimentação unitária e perturbações
    persistentes}
	\label{fig:diagrama-de-blocos-malha-fechada}
	\includegraphics[width=\textwidth]{images/diagrama-de-blocos-malha-fechada.png}
\end{figure}

A partir da Figura \ref{fig:diagrama-de-blocos-malha-fechada}, da álgebra de
diagramas de blocos e do princípio da superposição, chegou-se nas funções de
transferência abaixo. Estas funções serão utilizadas ao longo deste desafio.

\begin{equation}
    \label{eq:y2r-tf}
    \frac{Y(s)}{R(s)} = F(s)\frac{C(s)G(s)}{1 + C(s)G(s)}
\end{equation}

\begin{equation}
    \label{eq:y2qy-tf}
    \frac{Y(s)}{Q_{y}(s)} = \frac{1}{1 + C(s)G(s)}
\end{equation}

\begin{equation}
    \label{eq:y2qu-tf}
    \frac{Y(s)}{Q_{u}(s)} = \frac{G(s)}{1 + C(s)G(s)}
\end{equation}

\begin{equation}
    \label{eq:e2r-tf}
    \frac{E(s)}{R(s)} = F(s)\frac{1}{1 + C(s)G(s)}
\end{equation}

\begin{equation}
    \label{eq:u2r-tf}
    \frac{U(s)}{R(s)} = F(s)\frac{C(s)}{1 + C(s)G(s)}
\end{equation}

\begin{equation}
    \label{eq:u2qy-tf}
    \frac{U(s)}{Q_{y}(s)} = \frac{-C(s)G(s)}{1 + C(s)G(s)}
\end{equation}

\begin{equation}
    \label{eq:u2qu-tf}
    \frac{U(s)}{Q_{u}(s)} = \frac{-C(s)}{1 + C(s)G(s)}
\end{equation}

As simulações foram realizadas considerandos 4 cenários:
\begin{enumerate}
    \item Simulação do sistema para $R(s) = \frac{e^{-2s}}{s}$,
    $Q_{y}(s) = -0,2\frac{e^{-15s}}{s}$ e $Q_{u}(s) = -0,2\frac{e^{-25s}}{s}$
    dado $G(s) = \frac{2}{s}$, $C(s) = K$ e $F(s) = 1$ para um $K$ tal que o
    tempo de acomodação de 2\% para mudança de referência ao degrau seja igual
    a 4s;

    \item Simulação do sistema para $R(s) = \frac{e^{-2s}}{s}$,
    $R(s) = \frac{e^{-2s}}{s^{2}}$, $Q_{y}(s) = -0,2\frac{e^{-15s}}{s}$,
    $Q_{y}(s) = -0,2\frac{e^{-15s}}{s^{2}}$, $Q_{u}(s) = -0,2\frac{e^{-25s}}{s}$
    e $Q_{u}(s) = -0,2\frac{e^{-25s}}{s^{2}}$ dado $G(s) = \frac{2}{s}$, 
    $C(s) = K\frac{s + z}{s}$ e $F(s) = \frac{\tau_{n}s + 1}{\tau_{d}s + 1}$ 
    para um $K$ e $z$ tal que $P(s) = 1 + C(s)G(s)$ possua duas raízes dadas 
    por $s^{*} = -1$ e também $\tau_{n}$ e $\tau_{d}$ tal que o tempo de
    acomodação de 2\% para mudança de referência ao degrau seja igual a 6s
    dados os valores $K$ e $z$ obtidos;

    \item Simulação do sistema para $R(s) = \frac{e^{-2s}}{s}$,
    $Q_{y}(s) = -0,2\frac{e^{-15s}}{s^{2}}$ e
    $Q_{u}(s) = -0,2\frac{e^{-25s}}{s^{2}}$ dado $G(s) = \frac{2}{s}$,
    $C(s) = K\frac{s + z}{s}$ e $F(s) = \frac{\tau_{n}s + 1}{\tau_{d}s + 1}$ 
    para um $K$, $z$, $\tau_{n}$ e $\tau_{d}$ tal que o tempo de acomodação de
    2\% para mudança de referência ao degrau seja igual a 3s;

    \item Simulação do sistema para as mesmas entradas $R(s)$ do cenário 1 mas 
    também para $q_{y}(t) = 0,2sen(2t)\mathds{1}(t - 20)$ e 
    $q_{u}(t) = 0,2sen(2t)\mathds{1}(t - 40)$ dado $G(s) = \frac{2}{s + 1,5}$, 
    $C(s) = K\frac{s + z}{s}$, 
    $C(s) = K\left(\frac{s + z}{s}\right)\left(\frac{s^2 + 0,5s + 1.8^2}{s^2 + 2^2}\right)$ 
    e $F(s) = 1$ para um $K$, e $z$ tal que o tempo de acomodação de 2\% para 
    mudança de referência ao degrau seja igual a 2s.
\end{enumerate}

\subsection{Resultados obtidos}
As seguintes subseções irão descrever os resultados obtidos para os cenários
listados no tópico \ref{sec:simulacao-realizadas}.

\subsubsection{Cenário 1}
\label{subsub:cenario1}
Para $G(s)$, $C(s)$ e $F(s)$ dados, temos que

\begin{equation}
    \label{eq:y2r-comk-cenario1}
    \frac{Y(s)}{R(s)} = \frac{2K}{s + 2K}
\end{equation}

Como trata-se de um sistema de primeira ordem, temos também que $t_{s_{2\%}} =
4\tau$. Aplicando esta equação em \ref{eq:y2r-comk-cenario1}, obtemos $K = 0.5$.
Assim chegamos as seguintes funções de transferência:

\begin{equation}
    \label{eq:y2r-cenario1}
    \frac{Y(s)}{R(s)} = \frac{1}{s + 1},
\end{equation}

\begin{equation}
    \label{eq:y2qy-cenario1}
    \frac{Y(s)}{Q_{y}(s)} = \frac{s}{s + 1},
\end{equation}

\begin{equation}
    \label{eq:y2qu-cenario1}
    \frac{Y(s)}{Q_{u}(s)} = \frac{2}{s + 1}.
\end{equation}

A partir do princípio da superposição e da propriedade de linearidade pode se
obter a saída total do sistema através das somas das respostas individuais da
referência e das perturbações, isto é,

\begin{equation}
    \label{eq:saida-do-sistema}
    y(t) = y_{r}(t) + y_{q_{y}}(t) + y_{q_{u}}(t).
\end{equation}

Partindo da equação \ref{eq:saida-do-sistema} obteve-se a saída $y(t)$ para as
entradas $r(t) = \mathds{1}(t - 2)$, $q_{y}(t) = -0,2\mathds{1}(t - 15)$
$q_{u}(t) = -0,2\mathds{1}(t - 25)$. O mesmo princípio e propriedade foi usado
para obter o sinal de controle $u(t)$ dadas as entradas deslocadas no tempo. O
resultado obtido da simulação para o cenário 1 pode ser visualizado na Figura 
\ref{fig:resultado-desafio1-cenario1}.

\begin{figure}[!ht]
    \caption{Simulação do sistema de controle em malhada fechada para condições
    impostas no Cenário 1.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:resultado-desafio1-cenario1}
    \begin{minipage}{\linewidth}
        \input{images/resultado-desafio1-cenario1.tex}
    \end{minipage}
\end{figure}

É possível concluir pela Figura \ref{fig:resultado-desafio1-cenario1} que o
controlador permitiu que a saída seguisse a referência. Observa-se também que o
sistema rejeitou a perturbação na saída da malha de controle, o que é coerente
já que seguimento de referência é equivalente a rejeição na saída como é
demonstrado nas Equações \ref{eq:y2r-tf} e \ref{eq:e2r-tf}. Entretanto, o
sistema não conseguiu rejeitar uma perturbação na entrada. Essas conclusões
podem ser analisadas de forma conceitual pelo princípio do modelo interno. Como
a planta possui um polo na origem, que é o mesmo da perturbação de saída, a
perturbação é rejeitada. Porém, para a rejeição da perturbação na entrada é
preciso que ou o zero da planta ou o polo do controlador coincidam com o(s)
polo(s) da perturbações de entrada, o que não acontece para este cenário e,
portanto, não é possível rejeitar a perturbação de entrada.

Para enfatizar a conclusão acima, é aplicado o teorema do valor final para a
Equação \ref{eq:y2qu-cenario1} conforme Equação \ref{eq:limite-y2qu}.
Constata-se então um valor não nulo na saída $y(t)$ dado uma perturbação na
entrada $q_{u}(t) = -0,2\mathds{1}(t - 25)$.

\begin{equation}
    \label{eq:limite-y2qu}
    \lim_{s \rightarrow 0}s\left ( \frac{2}{s + 1}\frac{-0,2e^{-25s}}{s} \right ) = -0,4
\end{equation}

\subsubsection{Cenário 2}
Partindo de uma uma abordagem similar a realizada para o Cenário 1 conforme
subseção \ref{subsub:cenario1}, para $G(s)$, $C(s)$ e $F(s)$ dados, temos que

\begin{equation}
    \label{eq:y2r-comkz-cenario2}
    \frac{Y(s)}{R(s)} = F(s)\frac{2Ks + 2z}{s^2 + 2Ks + 2Kz}.
\end{equation}

Como requisito do problema de controle, foi imposto que as raízes em malha
fechada sejam dadas por $s^* = -1$. Igualando o denominador da Equação
\ref{eq:y2r-comkz-cenario2} ao polinônio $s^2 + 2s + 1$, chega-se aos valores
$K = 1$ e $z = 0,5$. Assim, a Equação \ref{eq:y2r-comkz-cenario2} torna-se 
a equação

\begin{equation}
    \label{eq:y2r-semkz-cenario2}
    \frac{Y(s)}{R(s)} = F(s)\frac{2s + 1}{s^2 + 2s + 1}
    = F(s)\frac{2s + 1}{(s+1)^2}.
\end{equation}

Observa-se na Equação \ref{eq:y2r-semkz-cenario2} que ela possui um zero em
$-0,5$, enquanto os dois polos estão localizados em $-1$. Este zero está na
região dominante irá interferir significativamente na resposta transitória do
sistema em malha fechada. Portanto, para $F(s) = \frac{\tau_{n}s + 1}{\tau_{d}s
+ 1}$ e um requisito de $t_{s_{2\%}} = 6s$, definiu-se os zeros e polos do
filtro de referência $F(s)$ de modo que o zero dominante seja eliminado do
sistema em malha fechada e também que o requisito de acomodação seja satisfeito.
Assim, $\tau_{n} = 0$ e $\tau_{d} = 2$, resultando na Equação
\ref{eq:y2r-comfiltro-cenario2}.

\begin{equation}
    \label{eq:y2r-comfiltro-cenario2}
    \frac{Y(s)}{R(s)} = \frac{1}{(s+1)^2}.
\end{equation}

Constata-se na Equação \ref{eq:y2r-comfiltro-cenario2} que $\tau = 1$. Para um
sistema com duas raízes no SPE iguais, $t_{s_{2\%}} \approx 6\tau$ e, portanto,
o requisito de tempo de acomodação foi satisfeito.

Com $C(s)$ e $F(s)$ definidos, as funções de transferência das perturbações foram
calculadas conforme equações:

\begin{equation}
    \label{eq:y2qy-cenario2}
    \frac{Y(s)}{Q_{y}(s)} = \frac{s^2}{(s + 1)^2},
\end{equation}

\begin{equation}
    \label{eq:y2qu-cenario2}
    \frac{Y(s)}{Q_{u}(s)} = \frac{2s}{(s + 1)^2}.
\end{equation}

A partir do mesmo princípio e propriedade apresentado no Cenário 1, chegou-se a
saída do sistema em malha fechada $y(t)$ dadas as entradas
$r(t) = \mathds{1}(t - 2)$, $q_{y}(t) = -0,2\mathds{1}(t - 15)$ e
$q_{u}(t) = -0,2\mathds{1}(t - 25)$, iguais as usadas no Cenário 1. O resultado
da simulação pode ser analisado na Figura \ref{fig:resultado-desafio1-cenario2-a}.

\begin{figure}[!ht]
    \caption{Simulação do sistema de controle em malhada fechada para condições
    impostas no Cenário 2 para perturbações do tipo degrau.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:resultado-desafio1-cenario2-a}
    \begin{minipage}{\linewidth}
        \input{images/resultado-desafio1-cenario2-a.tex}
    \end{minipage}
\end{figure}

Conclui-se na Figura \ref{fig:resultado-desafio1-cenario2-a} que igualmente ao
Cenário 1, o sistema em malha fechada seguiu referência e rejeitou a perturbação
de saída. Isso é evidente já que avaliando conceitualmente a partir do Princípio
do Modelo Interno, observa-se que o polo de $R(s)$ e de $Q_{y}(s)$ aparecem
tanto em $C(s)$ quanto $G(s)$. Entretanto, diferente do primeiro cenário, o
sistema também foi capaz de rejeitar a perturbação na entrada. Esta rejeição
aconteceu pois o polo de $Q_{u}(s)$ aparece no caminho de realimentação da saída
para a perturbação de entrada, sendo nesse caso o cancelamento dos polos
realizados pelo polo de $C(s)$. Cabe ainda uma observação para o sistema em
malha fechada em questão. Nota-se uma suavidade no sinal de controle $u(t)$. Em
problemas de controle de motores elétricos com cargas de alta inércia acopladas
ao seu eixo, a suavidade resulta em menor esforço da máquina, tendo como
consequência redução de manutenções corretivas.

Afim de avaliar também a saída do sistema em malha fechada em regime
estacionário, foi considerada perturbações do tipo rampa conforme as equações
a seguir:

\begin{equation}
    \label{eq:qys-rampa-cenario2}
    Q_{y}(s) = -0,2\frac{e^{-15s}}{s^2},
\end{equation}

\begin{equation}
    \label{eq:qus-rampa-cenario2}
    Q_{u}(s) = -0,2\frac{e^{-25s}}{s^{2}}
\end{equation}

Observa-se nas Equações \ref{eq:qys-rampa-cenario2} e
\ref{eq:qus-rampa-cenario2} a presença de dois polos na origem. Utilizando o
Princípio do Modelo Interno pode se prever que a perturbação na saída $q_{y}(t)$
será rejeitada já que a junção dos polos do controlador e da planta aparecem no
caminho de realimentação da função de transferência $\frac{Y(s)}{Q_{y}(s)}$.
Entretanto, o mesmo não acontece para a perturbação na entrada, pois apenas o
polo de $C(s)$ na origem aparece no caminho de realimentados da função de
transferência $\frac{Y(s)}{Q_{u}(s)}$. Assim, espera-se um valor diferente da
referência $r(t)$ em regime estacionário para $y(t)$ dado uma perturbação na
entrada do tipo rampa.

A Figura \ref{fig:resultado-desafio1-cenario2-b} apresenta os resultados para as
perturbações em rampa. Conforme esperado, o sistema em malha fechada não
rejeitou a perturbação na entrada. A saída $y(\infty) = 0,6$, sendo que o correto
era que $y(\infty) = r(\infty) = 1$.

\begin{figure}[!ht]
    \caption{Simulação do sistema de controle em malhada fechada para condições
    impostas no Cenário 2 para perturbações do tipo rampa.}
    \vspace{-10pt}
    \hspace{-30pt}
    \label{fig:resultado-desafio1-cenario2-b}
    \begin{minipage}{\linewidth}
        \input{images/resultado-desafio1-cenario2-b.tex}
    \end{minipage}
\end{figure}

\subsubsection{Cenário 3}
\subsubsection{Cenário 4}

\subsection{Conclusões}
(Concluir em que medida os resultados apresentam relação com a motivação.
Permitem ilustratar ou concluir algo sobre a motivação? )